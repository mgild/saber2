"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.withdrawInstruction = exports.depositInstruction = exports.swapInstruction = exports.createInitSwapInstruction = void 0;
var BufferLayout = __importStar(require("buffer-layout"));
var web3_js_1 = require("@solana/web3.js");
var u64_1 = require("./util/u64");
var layout_1 = require("./layout");
exports.createInitSwapInstruction = function (tokenSwapAccount, authority, adminAccount, adminFeeAccountA, adminFeeAccountB, tokenMintA, tokenAccountA, tokenMintB, tokenAccountB, poolTokenMint, poolTokenAccount, swapProgramId, tokenProgramId, nonce, ampFactor, fees) {
    var keys = [
        { pubkey: tokenSwapAccount.publicKey, isSigner: false, isWritable: true },
        { pubkey: authority, isSigner: false, isWritable: false },
        { pubkey: adminAccount, isSigner: false, isWritable: false },
        { pubkey: adminFeeAccountA, isSigner: false, isWritable: false },
        { pubkey: adminFeeAccountB, isSigner: false, isWritable: false },
        { pubkey: tokenMintA, isSigner: false, isWritable: false },
        { pubkey: tokenAccountA, isSigner: false, isWritable: false },
        { pubkey: tokenMintB, isSigner: false, isWritable: false },
        { pubkey: tokenAccountB, isSigner: false, isWritable: false },
        { pubkey: poolTokenMint, isSigner: false, isWritable: true },
        { pubkey: poolTokenAccount, isSigner: false, isWritable: true },
        { pubkey: tokenProgramId, isSigner: false, isWritable: false },
    ];
    var dataLayout = BufferLayout.struct([
        BufferLayout.u8("instruction"),
        BufferLayout.u8("nonce"),
        layout_1.Uint64Layout("ampFactor"),
        layout_1.Uint64Layout("adminTradeFeeNumerator"),
        layout_1.Uint64Layout("adminTradeFeeDenominator"),
        layout_1.Uint64Layout("adminWithdrawFeeNumerator"),
        layout_1.Uint64Layout("adminWithdrawFeeDenominator"),
        layout_1.Uint64Layout("tradeFeeNumerator"),
        layout_1.Uint64Layout("tradeFeeDenominator"),
        layout_1.Uint64Layout("withdrawFeeNumerator"),
        layout_1.Uint64Layout("withdrawFeeDenominator"),
    ]);
    var data = Buffer.alloc(dataLayout.span);
    {
        var encodeLength = dataLayout.encode({
            instruction: 0,
            nonce: nonce,
            ampFactor: new u64_1.NumberU64(ampFactor).toBuffer(),
            adminTradeFeeNumerator: new u64_1.NumberU64(fees.adminTradeFeeNumerator).toBuffer(),
            adminTradeFeeDenominator: new u64_1.NumberU64(fees.adminTradeFeeDenominator).toBuffer(),
            adminWithdrawFeeNumerator: new u64_1.NumberU64(fees.adminWithdrawFeeNumerator).toBuffer(),
            adminWithdrawFeeDenominator: new u64_1.NumberU64(fees.adminWithdrawFeeDenominator).toBuffer(),
            tradeFeeNumerator: new u64_1.NumberU64(fees.tradeFeeNumerator).toBuffer(),
            tradeFeeDenominator: new u64_1.NumberU64(fees.tradeFeeDenominator).toBuffer(),
            withdrawFeeNumerator: new u64_1.NumberU64(fees.withdrawFeeNumerator).toBuffer(),
            withdrawFeeDenominator: new u64_1.NumberU64(fees.withdrawFeeDenominator).toBuffer(),
        }, data);
        data = data.slice(0, encodeLength);
    }
    return new web3_js_1.TransactionInstruction({
        keys: keys,
        programId: swapProgramId,
        data: data,
    });
};
exports.swapInstruction = function (tokenSwap, authority, userSource, poolSource, poolDestination, userDestination, adminDestination, swapProgramId, tokenProgramId, amountIn, minimumAmountOut) {
    var dataLayout = BufferLayout.struct([
        BufferLayout.u8("instruction"),
        layout_1.Uint64Layout("amountIn"),
        layout_1.Uint64Layout("minimumAmountOut"),
    ]);
    var data = Buffer.alloc(dataLayout.span);
    dataLayout.encode({
        instruction: 1,
        amountIn: new u64_1.NumberU64(amountIn).toBuffer(),
        minimumAmountOut: new u64_1.NumberU64(minimumAmountOut).toBuffer(),
    }, data);
    var keys = [
        { pubkey: tokenSwap, isSigner: false, isWritable: false },
        { pubkey: authority, isSigner: false, isWritable: false },
        { pubkey: userSource, isSigner: false, isWritable: true },
        { pubkey: poolSource, isSigner: false, isWritable: true },
        { pubkey: poolDestination, isSigner: false, isWritable: true },
        { pubkey: userDestination, isSigner: false, isWritable: true },
        { pubkey: adminDestination, isSigner: false, isWritable: true },
        { pubkey: tokenProgramId, isSigner: false, isWritable: false },
        { pubkey: web3_js_1.SYSVAR_CLOCK_PUBKEY, isSigner: false, isWritable: false },
    ];
    return new web3_js_1.TransactionInstruction({
        keys: keys,
        programId: swapProgramId,
        data: data,
    });
};
exports.depositInstruction = function (tokenSwap, authority, sourceA, sourceB, intoA, intoB, poolTokenMint, poolTokenAccount, swapProgramId, tokenProgramId, tokenAmountA, tokenAmountB, minimumPoolTokenAmount) {
    var dataLayout = BufferLayout.struct([
        BufferLayout.u8("instruction"),
        layout_1.Uint64Layout("tokenAmountA"),
        layout_1.Uint64Layout("tokenAmountB"),
        layout_1.Uint64Layout("minimumPoolTokenAmount"),
    ]);
    var data = Buffer.alloc(dataLayout.span);
    dataLayout.encode({
        instruction: 2,
        tokenAmountA: new u64_1.NumberU64(tokenAmountA).toBuffer(),
        tokenAmountB: new u64_1.NumberU64(tokenAmountB).toBuffer(),
        minimumPoolTokenAmount: new u64_1.NumberU64(minimumPoolTokenAmount).toBuffer(),
    }, data);
    var keys = [
        { pubkey: tokenSwap, isSigner: false, isWritable: false },
        { pubkey: authority, isSigner: false, isWritable: false },
        { pubkey: sourceA, isSigner: false, isWritable: true },
        { pubkey: sourceB, isSigner: false, isWritable: true },
        { pubkey: intoA, isSigner: false, isWritable: true },
        { pubkey: intoB, isSigner: false, isWritable: true },
        { pubkey: poolTokenMint, isSigner: false, isWritable: true },
        { pubkey: poolTokenAccount, isSigner: false, isWritable: true },
        { pubkey: tokenProgramId, isSigner: false, isWritable: false },
        { pubkey: web3_js_1.SYSVAR_CLOCK_PUBKEY, isSigner: false, isWritable: false },
    ];
    return new web3_js_1.TransactionInstruction({
        keys: keys,
        programId: swapProgramId,
        data: data,
    });
};
exports.withdrawInstruction = function (tokenSwap, authority, poolMint, sourcePoolAccount, fromA, fromB, userAccountA, userAccountB, adminFeeAccountA, adminFeeAccountB, swapProgramId, tokenProgramId, poolTokenAmount, minimumTokenA, minimumTokenB) {
    var dataLayout = BufferLayout.struct([
        BufferLayout.u8("instruction"),
        layout_1.Uint64Layout("poolTokenAmount"),
        layout_1.Uint64Layout("minimumTokenA"),
        layout_1.Uint64Layout("minimumTokenB"),
    ]);
    var data = Buffer.alloc(dataLayout.span);
    dataLayout.encode({
        instruction: 3,
        poolTokenAmount: new u64_1.NumberU64(poolTokenAmount).toBuffer(),
        minimumTokenA: new u64_1.NumberU64(minimumTokenA).toBuffer(),
        minimumTokenB: new u64_1.NumberU64(minimumTokenB).toBuffer(),
    }, data);
    var keys = [
        { pubkey: tokenSwap, isSigner: false, isWritable: false },
        { pubkey: authority, isSigner: false, isWritable: false },
        { pubkey: poolMint, isSigner: false, isWritable: true },
        { pubkey: sourcePoolAccount, isSigner: false, isWritable: true },
        { pubkey: fromA, isSigner: false, isWritable: true },
        { pubkey: fromB, isSigner: false, isWritable: true },
        { pubkey: userAccountA, isSigner: false, isWritable: true },
        { pubkey: userAccountB, isSigner: false, isWritable: true },
        { pubkey: adminFeeAccountA, isSigner: false, isWritable: true },
        { pubkey: adminFeeAccountB, isSigner: false, isWritable: true },
        { pubkey: tokenProgramId, isSigner: false, isWritable: false },
    ];
    return new web3_js_1.TransactionInstruction({
        keys: keys,
        programId: swapProgramId,
        data: data,
    });
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5zdHJ1Y3Rpb25zLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2luc3RydWN0aW9ucy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsMERBQThDO0FBQzlDLDJDQUt5QjtBQUV6QixrQ0FBdUM7QUFDdkMsbUNBQXdDO0FBRzNCLFFBQUEseUJBQXlCLEdBQUcsVUFDdkMsZ0JBQXlCLEVBQ3pCLFNBQW9CLEVBQ3BCLFlBQXVCLEVBQ3ZCLGdCQUEyQixFQUMzQixnQkFBMkIsRUFDM0IsVUFBcUIsRUFDckIsYUFBd0IsRUFDeEIsVUFBcUIsRUFDckIsYUFBd0IsRUFDeEIsYUFBd0IsRUFDeEIsZ0JBQTJCLEVBQzNCLGFBQXdCLEVBQ3hCLGNBQXlCLEVBQ3pCLEtBQWEsRUFDYixTQUE2QixFQUM3QixJQUFVO0lBRVYsSUFBTSxJQUFJLEdBQUc7UUFDWCxFQUFFLE1BQU0sRUFBRSxnQkFBZ0IsQ0FBQyxTQUFTLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsSUFBSSxFQUFFO1FBQ3pFLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUU7UUFDekQsRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBRTtRQUM1RCxFQUFFLE1BQU0sRUFBRSxnQkFBZ0IsRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUU7UUFDaEUsRUFBRSxNQUFNLEVBQUUsZ0JBQWdCLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFO1FBQ2hFLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUU7UUFDMUQsRUFBRSxNQUFNLEVBQUUsYUFBYSxFQUFFLFFBQVEs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QUFNLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBRTtRQUN6RCxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsSUFBSSxFQUFFO1FBQ3ZELEVBQUUsTUFBTSxFQUFFLGlCQUFpQixFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRTtRQUNoRSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsSUFBSSxFQUFFO1FBQ3BELEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUU7UUFDcEQsRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRTtRQUMzRCxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsSUFBSSxFQUFFO1FBQzNELEVBQUUsTUFBTSxFQUFFLGdCQUFnQixFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRTtRQUMvRCxFQUFFLE1BQU0sRUFBRSxnQkFBZ0IsRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUU7UUFDL0QsRUFBRSxNQUFNLEVBQUUsY0FBYyxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBRTtLQUMvRCxDQUFDO0lBQ0YsT0FBTyxJQUFJLGdDQUFzQixDQUFDO1FBQ2hDLElBQUksTUFBQTtRQUNKLFNBQVMsRUFBRSxhQUFhO1FBQ3hCLElBQUksTUFBQTtLQUNMLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIEJ1ZmZlckxheW91dCBmcm9tIFwiYnVmZmVyLWxheW91dFwiO1xuaW1wb3J0IHtcbiAgQWNjb3VudCxcbiAgUHVibGljS2V5LFxuICBUcmFuc2FjdGlvbkluc3RydWN0aW9uLFxuICBTWVNWQVJfQ0xPQ0tfUFVCS0VZLFxufSBmcm9tIFwiQHNvbGFuYS93ZWIzLmpzXCI7XG5cbmltcG9ydCB7IE51bWJlclU2NCB9IGZyb20gXCIuL3V0aWwvdTY0XCI7XG5pbXBvcnQgeyBVaW50NjRMYXlvdXQgfSBmcm9tIFwiLi9sYXlvdXRcIjtcbmltcG9ydCB7IEZlZXMgfSBmcm9tIFwiLi9mZWVzXCI7XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVJbml0U3dhcEluc3RydWN0aW9uID0gKFxuICB0b2tlblN3YXBBY2NvdW50OiBBY2NvdW50LFxuICBhdXRob3JpdHk6IFB1YmxpY0tleSxcbiAgYWRtaW5BY2NvdW50OiBQdWJsaWNLZXksXG4gIGFkbWluRmVlQWNjb3VudEE6IFB1YmxpY0tleSxcbiAgYWRtaW5GZWVBY2NvdW50QjogUHVibGljS2V5LFxuICB0b2tlbk1pbnRBOiBQdWJsaWNLZXksXG4gIHRva2VuQWNjb3VudEE6IFB1YmxpY0tleSxcbiAgdG9rZW5NaW50QjogUHVibGljS2V5LFxuICB0b2tlbkFjY291bnRCOiBQdWJsaWNLZXksXG4gIHBvb2xUb2tlbk1pbnQ6IFB1YmxpY0tleSxcbiAgcG9vbFRva2VuQWNjb3VudDogUHVibGljS2V5LFxuICBzd2FwUHJvZ3JhbUlkOiBQdWJsaWNLZXksXG4gIHRva2VuUHJvZ3JhbUlkOiBQdWJsaWNLZXksXG4gIG5vbmNlOiBudW1iZXIsXG4gIGFtcEZhY3RvcjogbnVtYmVyIHwgTnVtYmVyVTY0LFxuICBmZWVzOiBGZWVzXG4pOiBUcmFuc2FjdGlvbkluc3RydWN0aW9uID0+IHtcbiAgY29uc3Qga2V5cyA9IFtcbiAgICB7IHB1YmtleTogdG9rZW5Td2FwQWNjb3VudC5wdWJsaWNLZXksIGlzU2lnbmVyOiBmYWxzZSwgaXNXcml0YWJsZTogdHJ1ZSB9LFxuICAgIHsgcHVia2V5OiBhdXRob3JpdHksIGlzU2lnbmVyOiBmYWxzZSwgaXNXcml0YWJsZTogZmFsc2UgfSxcbiAgICB7IHB1YmtleTogYWRtaW5BY2NvdW50LCBpc1NpZ25lcjogZmFsc2UsIGlzV3JpdGFibGU6IGZhbHNlIH0sXG4gICAgeyBwdWJrZXk6IGFkbWluRmVlQWNjb3VudEEsIGlzU2lnbmVyOiBmYWxzZSwgaXNXcml0YWJsZTogZmFsc2UgfSxcbiAgICB7IHB1YmtleTogYWRtaW5GZWVBY2NvdW50QiwgaXNTaWduZXI6IGZhbHNlLCBpc1dyaXRhYmxlOiBmYWxzZSB9LFxuICAgIHsgcHVia2V5OiB0b2tlbk1pbnRBLCBpc1NpZ25lcjogZmFsc2UsIGlzV3JpdGFibGU6IGZhbHNlIH0sXG4gICAgeyBwdWJrZXk6IHRva2VuQWNjb3VudEEsIGlzU2lnbmVyOiBmYWxzZSwgaXNXcml0YWJsZTogZmFsc2UgfSxcbiAgICB7IHB1YmtleTogdG9rZW5NaW50QiwgaXNTaWduZXI6IGZhbHNlLCBpc1dyaXRhYmxlOiBmYWxzZSB9LFxuICAgIHsgcHVia2V5OiB0b2tlbkFjY291bnRCLCBpc1NpZ25lcjogZmFsc2UsIGlzV3JpdGFibGU6IGZhbHNlIH0sXG4gICAgeyBwdWJrZXk6IHBvb2xUb2tlbk1pbnQsIGlzU2lnbmVyOiBmYWxzZSwgaXNXcml0YWJsZTogdHJ1ZSB9LFxuICAgIHsgcHVia2V5OiBwb29sVG9rZW5BY2NvdW50LCBpc1NpZ25lcjogZmFsc2UsIGlzV3JpdGFibGU6IHRydWUgfSxcbiAgICB7IHB1YmtleTogdG9rZW5Qcm9ncmFtSWQsIGlzU2lnbmVyOiBmYWxzZSwgaXNXcml0YWJsZTogZmFsc2UgfSxcbiAgXTtcbiAgY29uc3QgZGF0YUxheW91dCA9IEJ1ZmZlckxheW91dC5zdHJ1Y3QoW1xuICAgIEJ1ZmZlckxheW91dC51OChcImluc3RydWN0aW9uXCIpLFxuICAgIEJ1ZmZlckxheW91dC51OChcIm5vbmNlXCIpLFxuICAgIFVpbnQ2NExheW91dChcImFtcEZhY3RvclwiKSxcbiAgICBVaW50NjRMYXlvdXQoXCJhZG1pblRyYWRlRmVlTnVtZXJhdG9yXCIpLFxuICAgIFVpbnQ2NExheW91dChcImFkbWluVHJhZGVGZWVEZW5vbWluYXRvclwiKSxcbiAgICBVaW50NjRMYXlvdXQoXCJhZG1pbldpdGhkcmF3RmVlTnVtZXJhdG9yXCIpLFxuICAgIFVpbnQ2NExheW91dChcImFkbWluV2l0aGRyYXdGZWVEZW5vbWluYXRvclwiKSxcbiAgICBVaW50NjRMYXlvdXQoXCJ0cmFkZUZlZU51bWVyYXRvclwiKSxcbiAgICBVaW50NjRMYXlvdXQoXCJ0cmFkZUZlZURlbm9taW5hdG9yXCIpLFxuICAgIFVpbnQ2NExheW91dChcIndpdGhkcmF3RmVlTnVtZXJhdG9yXCIpLFxuICAgIFVpbnQ2NExheW91dChcIndpdGhkcmF3RmVlRGVub21pbmF0b3JcIiksXG4gIF0pO1xuICBsZXQgZGF0YSA9IEJ1ZmZlci5hbGxvYyhkYXRhTGF5b3V0LnNwYW4pO1xuICB7XG4gICAgY29uc3QgZW5jb2RlTGVuZ3RoID0gZGF0YUxheW91dC5lbmNvZGUoXG4gICAgICB7XG4gICAgICAgIGluc3RydWN0aW9uOiAwLCAvLyBJbml0aWFsaXplU3dhcCBpbnN0cnVjdGlvblxuICAgICAgICBub25jZSxcbiAgICAgICAgYW1wRmFjdG9yOiBuZXcgTnVtYmVyVTY0KGFtcEZhY3RvcikudG9CdWZmZXIoKSxcbiAgICAgICAgYWRtaW5UcmFkZUZlZU51bWVyYXRvcjogbmV3IE51bWJlclU2NChcbiAgICAgICAgICBmZWVzLmFkbWluVHJhZGVGZWVOdW1lcmF0b3JcbiAgICAgICAgKS50b0J1ZmZlcigpLFxuICAgICAgICBhZG1pblRyYWRlRmVlRGVub21pbmF0b3I6IG5ldyBOdW1iZXJVNjQoXG4gICAgICAgICAgZmVlcy5hZG1pblRyYWRlRmVlRGVub21pbmF0b3JcbiAgICAgICAgKS50b0J1ZmZlcigpLFxuICAgICAgICBhZG1pbldpdGhkcmF3RmVlTnVtZXJhdG9yOiBuZXcgTnVtYmVyVTY0KFxuICAgICAgICAgIGZlZXMuYWRtaW5XaXRoZHJhd0ZlZU51bWVyYXRvclxuICAgICAgICApLnRvQnVmZmVyKCksXG4gICAgICAgIGFkbWluV2l0aGRyYXdGZWVEZW5vbWluYXRvcjogbmV3IE51bWJlclU2NChcbiAgICAgICAgICBmZWVzLmFkbWluV2l0aGRyYXdGZWVEZW5vbWluYXRvclxuICAgICAgICApLnRvQnVmZmVyKCksXG4gICAgICAgIHRyYWRlRmVlTnVtZXJhdG9yOiBuZXcgTnVtYmVyVTY0KGZlZXMudHJhZGVGZWVOdW1lcmF0b3IpLnRvQnVmZmVyKCksXG4gICAgICAgIHRyYWRlRmVlRGVub21pbmF0b3I6IG5ldyBOdW1iZXJVNjQoZmVlcy50cmFkZUZlZURlbm9taW5hdG9yKS50b0J1ZmZlcigpLFxuICAgICAgICB3aXRoZHJhd0ZlZU51bWVyYXRvcjogbmV3IE51bWJlclU2NChcbiAgICAgICAgICBmZWVzLndpdGhkcmF3RmVlTnVtZXJhdG9yXG4gICAgICAgICkudG9CdWZmZXIoKSxcbiAgICAgICAgd2l0aGRyYXdGZWVEZW5vbWluYXRvcjogbmV3IE51bWJlclU2NChcbiAgICAgICAgICBmZWVzLndpdGhkcmF3RmVlRGVub21pbmF0b3JcbiAgICAgICAgKS50b0J1ZmZlcigpLFxuICAgICAgfSxcbiAgICAgIGRhdGFcbiAgICApO1xuICAgIGRhdGEgPSBkYXRhLnNsaWNlKDAsIGVuY29kZUxlbmd0aCk7XG4gIH1cbiAgcmV0dXJuIG5ldyBUcmFuc2FjdGlvbkluc3RydWN0aW9uKHtcbiAgICBrZXlzLFxuICAgIHByb2dyYW1JZDogc3dhcFByb2dyYW1JZCxcbiAgICBkYXRhLFxuICB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCBzd2FwSW5zdHJ1Y3Rpb24gPSAoXG4gIHRva2VuU3dhcDogUHVibGljS2V5LFxuICBhdXRob3JpdHk6IFB1YmxpY0tleSxcbiAgdXNlclNvdXJjZTogUHVibGljS2V5LFxuICBwb29sU291cmNlOiBQdWJsaWNLZXksXG4gIHBvb2xEZXN0aW5hdGlvbjogUHVibGljS2V5LFxuICB1c2VyRGVzdGluYXRpb246IFB1YmxpY0tleSxcbiAgYWRtaW5EZXN0aW5hdGlvbjogUHVibGljS2V5LFxuICBzd2FwUHJvZ3JhbUlkOiBQdWJsaWNLZXksXG4gIHRva2VuUHJvZ3JhbUlkOiBQdWJsaWNLZXksXG4gIGFtb3VudEluOiBudW1iZXIgfCBOdW1iZXJVNjQsXG4gIG1pbmltdW1BbW91bnRPdXQ6IG51bWJlciB8IE51bWJlclU2NFxuKTogVHJhbnNhY3Rpb25JbnN0cnVjdGlvbiA9PiB7XG4gIGNvbnN0IGRhdGFMYXlvdXQgPSBCdWZmZXJMYXlvdXQuc3RydWN0KFtcbiAgICBCdWZmZXJMYXlvdXQudTgoXCJpbnN0cnVjdGlvblwiKSxcbiAgICBVaW50NjRMYXlvdXQoXCJhbW91bnRJblwiKSxcbiAgICBVaW50NjRMYXlvdXQoXCJtaW5pbXVtQW1vdW50T3V0XCIpLFxuICBdKTtcblxuICBjb25zdCBkYXRhID0gQnVmZmVyLmFsbG9jKGRhdGFMYXlvdXQuc3Bhbik7XG4gIGRhdGFMYXlvdXQuZW5jb2RlKFxuICAgIHtcbiAgICAgIGluc3RydWN0aW9uOiAxLCAvLyBTd2FwIGluc3RydWN0aW9uXG4gICAgICBhbW91bnRJbjogbmV3IE51bWJlclU2NChhbW91bnRJbikudG9CdWZmZXIoKSxcbiAgICAgIG1pbmltdW1BbW91bnRPdXQ6IG5ldyBOdW1iZXJVNjQobWluaW11bUFtb3VudE91dCkudG9CdWZmZXIoKSxcbiAgICB9LFxuICAgIGRhdGFcbiAgKTtcblxuICBjb25zdCBrZXlzID0gW1xuICAgIHsgcHVia2V5OiB0b2tlblN3YXAsIGlzU2lnbmVyOiBmYWxzZSwgaXNXcml0YWJsZTogZmFsc2UgfSxcbiAgICB7IHB1YmtleTogYXV0aG9yaXR5LCBpc1NpZ25lcjogZmFsc2UsIGlzV3JpdGFibGU6IGZhbHNlIH0sXG4gICAgeyBwdWJrZXk6IHVzZXJTb3VyY2UsIGlzU2lnbmVyOiBmYWxzZSwgaXNXcml0YWJsZTogdHJ1ZSB9LFxuICAgIHsgcHVia2V5OiBwb29sU291cmNlLCBpc1NpZ25lcjogZmFsc2UsIGlzV3JpdGFibGU6IHRydWUgfSxcbiAgICB7IHB1YmtleTogcG9vbERlc3RpbmF0aW9uLCBpc1NpZ25lcjogZmFsc2UsIGlzV3JpdGFibGU6IHRydWUgfSxcbiAgICB7IHB1YmtleTogdXNlckRlc3RpbmF0aW9uLCBpc1NpZ25lcjogZmFsc2UsIGlzV3JpdGFibGU6IHRydWUgfSxcbiAgICB7IHB1YmtleTogYWRtaW5EZXN0aW5hdGlvbiwgaXNTaWduZXI6IGZhbHNlLCBpc1dyaXRhYmxlOiB0cnVlIH0sXG4gICAgeyBwdWJrZXk6IHRva2VuUHJvZ3JhbUlkLCBpc1NpZ25lcjogZmFsc2UsIGlzV3JpdGFibGU6IGZhbHNlIH0sXG4gICAgeyBwdWJrZXk6IFNZU1ZBUl9DTE9DS19QVUJLRVksIGlzU2lnbmVyOiBmYWxzZSwgaXNXcml0YWJsZTogZmFsc2UgfSxcbiAgXTtcbiAgcmV0dXJuIG5ldyBUcmFuc2FjdGlvbkluc3RydWN0aW9uKHtcbiAgICBrZXlzLFxuICAgIHByb2dyYW1JZDogc3dhcFByb2dyYW1JZCxcbiAgICBkYXRhLFxuICB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCBkZXBvc2l0SW5zdHJ1Y3Rpb24gPSAoXG4gIHRva2VuU3dhcDogUHVibGljS2V5LFxuICBhdXRob3JpdHk6IFB1YmxpY0tleSxcbiAgc291cmNlQTogUHVibGljS2V5LFxuICBzb3VyY2VCOiBQdWJsaWNLZXksXG4gIGludG9BOiBQdWJsaWNLZXksXG4gIGludG9COiBQdWJsaWNLZXksXG4gIHBvb2xUb2tlbk1pbnQ6IFB1YmxpY0tleSxcbiAgcG9vbFRva2VuQWNjb3VudDogUHVibGljS2V5LFxuICBzd2FwUHJvZ3JhbUlkOiBQdWJsaWNLZXksXG4gIHRva2VuUHJvZ3JhbUlkOiBQdWJsaWNLZXksXG4gIHRva2VuQW1vdW50QTogbnVtYmVyIHwgTnVtYmVyVTY0LFxuICB0b2tlbkFtb3VudEI6IG51bWJlciB8IE51bWJlclU2NCxcbiAgbWluaW11bVBvb2xUb2tlbkFtb3VudDogbnVtYmVyIHwgTnVtYmVyVTY0XG4pOiBUcmFuc2FjdGlvbkluc3RydWN0aW9uID0+IHtcbiAgY29uc3QgZGF0YUxheW91dCA9IEJ1ZmZlckxheW91dC5zdHJ1Y3QoW1xuICAgIEJ1ZmZlckxheW91dC51OChcImluc3RydWN0aW9uXCIpLFxuICAgIFVpbnQ2NExheW91dChcInRva2VuQW1vdW50QVwiKSxcbiAgICBVaW50NjRMYXlvdXQoXCJ0b2tlbkFtb3VudEJcIiksXG4gICAgVWludDY0TGF5b3V0KFwibWluaW11bVBvb2xUb2tlbkFtb3VudFwiKSxcbiAgXSk7XG4gIGNvbnN0IGRhdGEgPSBCdWZmZXIuYWxsb2MoZGF0YUxheW91dC5zcGFuKTtcbiAgZGF0YUxheW91dC5lbmNvZGUoXG4gICAge1xuICAgICAgaW5zdHJ1Y3Rpb246IDIsIC8vIERlcG9zaXQgaW5zdHJ1Y3Rpb25cbiAgICAgIHRva2VuQW1vdW50QTogbmV3IE51bWJlclU2NCh0b2tlbkFtb3VudEEpLnRvQnVmZmVyKCksXG4gICAgICB0b2tlbkFtb3VudEI6IG5ldyBOdW1iZXJVNjQodG9rZW5BbW91bnRCKS50b0J1ZmZlcigpLFxuICAgICAgbWluaW11bVBvb2xUb2tlbkFtb3VudDogbmV3IE51bWJlclU2NChtaW5pbXVtUG9vbFRva2VuQW1vdW50KS50b0J1ZmZlcigpLFxuICAgIH0sXG4gICAgZGF0YVxuICApO1xuXG4gIGNvbnN0IGtleXMgPSBbXG4gICAgeyBwdWJrZXk6IHRva2VuU3dhcCwgaXNTaWduZXI6IGZhbHNlLCBpc1dyaXRhYmxlOiBmYWxzZSB9LFxuICAgIHsgcHVia2V5OiBhdXRob3JpdHksIGlzU2lnbmVyOiBmYWxzZSwgaXNXcml0YWJsZTogZmFsc2UgfSxcbiAgICB7IHB1YmtleTogc291cmNlQSwgaXNTaWduZXI6IGZhbHNlLCBpc1dyaXRhYmxlOiB0cnVlIH0sXG4gICAgeyBwdWJrZXk6IHNvdXJjZUIsIGlzU2lnbmVyOiBmYWxzZSwgaXNXcml0YWJsZTogdHJ1ZSB9LFxuICAgIHsgcHVia2V5OiBpbnRvQSwgaXNTaWduZXI6IGZhbHNlLCBpc1dyaXRhYmxlOiB0cnVlIH0sXG4gICAgeyBwdWJrZXk6IGludG9CLCBpc1NpZ25lcjogZmFsc2UsIGlzV3JpdGFibGU6IHRydWUgfSxcbiAgICB7IHB1YmtleTogcG9vbFRva2VuTWludCwgaXNTaWduZXI6IGZhbHNlLCBpc1dyaXRhYmxlOiB0cnVlIH0sXG4gICAgeyBwdWJrZXk6IHBvb2xUb2tlbkFjY291bnQsIGlzU2lnbmVyOiBmYWxzZSwgaXNXcml0YWJsZTogdHJ1ZSB9LFxuICAgIHsgcHVia2V5OiB0b2tlblByb2dyYW1JZCwgaXNTaWduZXI6IGZhbHNlLCBpc1dyaXRhYmxlOiBmYWxzZSB9LFxuICAgIHsgcHVia2V5OiBTWVNWQVJfQ0xPQ0tfUFVCS0VZLCBpc1NpZ25lcjogZmFsc2UsIGlzV3JpdGFibGU6IGZhbHNlIH0sXG4gIF07XG4gIHJldHVybiBuZXcgVHJhbnNhY3Rpb25JbnN0cnVjdGlvbih7XG4gICAga2V5cyxcbiAgICBwcm9ncmFtSWQ6IHN3YXBQcm9ncmFtSWQsXG4gICAgZGF0YSxcbiAgfSk7XG59O1xuXG5leHBvcnQgY29uc3Qgd2l0aGRyYXdJbnN0cnVjdGlvbiA9IChcbiAgdG9rZW5Td2FwOiBQdWJsaWNLZXksXG4gIGF1dGhvcml0eTogUHVibGljS2V5LFxuICBwb29sTWludDogUHVibGljS2V5LFxuICBzb3VyY2VQb29sQWNjb3VudDogUHVibGljS2V5LFxuICBmcm9tQTogUHVibGljS2V5LFxuICBmcm9tQjogUHVibGljS2V5LFxuICB1c2VyQWNjb3VudEE6IFB1YmxpY0tleSxcbiAgdXNlckFjY291bnRCOiBQdWJsaWNLZXksXG4gIGFkbWluRmVlQWNjb3VudEE6IFB1YmxpY0tleSxcbiAgYWRtaW5GZWVBY2NvdW50QjogUHVibGljS2V5LFxuICBzd2FwUHJvZ3JhbUlkOiBQdWJsaWNLZXksXG4gIHRva2VuUHJvZ3JhbUlkOiBQdWJsaWNLZXksXG4gIHBvb2xUb2tlbkFtb3VudDogbnVtYmVyIHwgTnVtYmVyVTY0LFxuICBtaW5pbXVtVG9rZW5BOiBudW1iZXIgfCBOdW1iZXJVNjQsXG4gIG1pbmltdW1Ub2tlbkI6IG51bWJlciB8IE51bWJlclU2NFxuKTogVHJhbnNhY3Rpb25JbnN0cnVjdGlvbiA9PiB7XG4gIGNvbnN0IGRhdGFMYXlvdXQgPSBCdWZmZXJMYXlvdXQuc3RydWN0KFtcbiAgICBCdWZmZXJMYXlvdXQudTgoXCJpbnN0cnVjdGlvblwiKSxcbiAgICBVaW50NjRMYXlvdXQoXCJwb29sVG9rZW5BbW91bnRcIiksXG4gICAgVWludDY0TGF5b3V0KFwibWluaW11bVRva2VuQVwiKSxcbiAgICBVaW50NjRMYXlvdXQoXCJtaW5pbXVtVG9rZW5CXCIpLFxuICBdKTtcblxuICBjb25zdCBkYXRhID0gQnVmZmVyLmFsbG9jKGRhdGFMYXlvdXQuc3Bhbik7XG4gIGRhdGFMYXlvdXQuZW5jb2RlKFxuICAgIHtcbiAgICAgIGluc3RydWN0aW9uOiAzLCAvLyBXaXRoZHJhdyBpbnN0cnVjdGlvblxuICAgICAgcG9vbFRva2VuQW1vdW50OiBuZXcgTnVtYmVyVTY0KHBvb2xUb2tlbkFtb3VudCkudG9CdWZmZXIoKSxcbiAgICAgIG1pbmltdW1Ub2tlbkE6IG5ldyBOdW1iZXJVNjQobWluaW11bVRva2VuQSkudG9CdWZmZXIoKSxcbiAgICAgIG1pbmltdW1Ub2tlbkI6IG5ldyBOdW1iZXJVNjQobWluaW11bVRva2VuQikudG9CdWZmZXIoKSxcbiAgICB9LFxuICAgIGRhdGFcbiAgKTtcblxuICBjb25zdCBrZXlzID0gW1xuICAgIHsgcHVia2V5OiB0b2tlblN3YXAsIGlzU2lnbmVyOiBmYWxzZSwgaXNXcml0YWJsZTogZmFsc2UgfSxcbiAgICB7IHB1YmtleTogYXV0aG9yaXR5LCBpc1NpZ25lcjogZmFsc2UsIGlzV3JpdGFibGU6IGZhbHNlIH0sXG4gICAgeyBwdWJrZXk6IHBvb2xNaW50LCBpc1NpZ25lcjogZmFsc2UsIGlzV3JpdGFibGU6IHRydWUgfSxcbiAgICB7IHB1YmtleTogc291cmNlUG9vbEFjY291bnQsIGlzU2lnbmVyOiBmYWxzZSwgaXNXcml0YWJsZTogdHJ1ZSB9LFxuICAgIHsgcHVia2V5OiBmcm9tQSwgaXNTaWduZXI6IGZhbHNlLCBpc1dyaXRhYmxlOiB0cnVlIH0sXG4gICAgeyBwdWJrZXk6IGZyb21CLCBpc1NpZ25lcjogZmFsc2UsIGlzV3JpdGFibGU6IHRydWUgfSxcbiAgICB7IHB1YmtleTogdXNlckFjY291bnRBLCBpc1NpZ25lcjogZmFsc2UsIGlzV3JpdGFibGU6IHRydWUgfSxcbiAgICB7IHB1YmtleTogdXNlckFjY291bnRCLCBpc1NpZ25lcjogZmFsc2UsIGlzV3JpdGFibGU6IHRydWUgfSxcbiAgICB7IHB1YmtleTogYWRtaW5GZWVBY2NvdW50QSwgaXNTaWduZXI6IGZhbHNlLCBpc1dyaXRhYmxlOiB0cnVlIH0sXG4gICAgeyBwdWJrZXk6IGFkbWluRmVlQWNjb3VudEIsIGlzU2lnbmVyOiBmYWxzZSwgaXNXcml0YWJsZTogdHJ1ZSB9LFxuICAgIHsgcHVia2V5OiB0b2tlblByb2dyYW1JZCwgaXNTaWduZXI6IGZhbHNlLCBpc1dyaXRhYmxlOiBmYWxzZSB9LFxuICBdO1xuICByZXR1cm4gbmV3IFRyYW5zYWN0aW9uSW5zdHJ1Y3Rpb24oe1xuICAgIGtleXMsXG4gICAgcHJvZ3JhbUlkOiBzd2FwUHJvZ3JhbUlkLFxuICAgIGRhdGEsXG4gIH0pO1xufTtcbiJdfQ==